@page "/product-detail/{ProductId}"
@using TCH.Data.Entities
@using TCH.WebServer.Services.Orders
@using TCH.WebServer.Services.Products

@inject IOrderService orderService
@inject IProductService productService

<div class="page d-flex flex-row flex-column-fluid">
    <TCH.WebServer.Pages.SideBar.SidebarUser></TCH.WebServer.Pages.SideBar.SidebarUser>
    <div class="wrapper d-flex flex-column flex-row-fluid" id="kt_wrapper">
        <TCH.WebServer.Shared.Header.Header></TCH.WebServer.Shared.Header.Header>
        <div class="content d-flex flex-column flex-column-fluid" id="kt_content">
            @if (order != null && product != null && orderDetail != null)
            {
                <div class="d-flex flex-column flex-column-fluid container-fluid" style="">
                    <!--begin::Post-->
                <div class="content flex-column-fluid" id="kt_content">
                        <!--begin::Stats-->
                    <div class="row g-6 g-xl-9">
                            <div class="col-lg-6 col-xxl-4">
                                <!--begin::Card-->
                            <div class="card h-200">
                                    <!--begin::Card body-->
                                <div class="card-body p-9">
                                        <a class="d-block overlay" data-fslightbox="lightbox-hot-sales" href="@("https://localhost:8001/uploads" + product.LinkImage)">
                                            <!--begin::Image-->
                                        <div class="overlay-wrapper bgi-no-repeat bgi-position-center bgi-size-cover card-rounded min-h-175px" style="background-image:url(@("https://localhost:8001/uploads" + product.LinkImage))"></div>
                                            <!--end::Image-->
                                            <!--begin::Action-->
                                        <div class="overlay-layer card-rounded bg-dark bg-opacity-25">
                                                <i class="bi bi-eye-fill fs-2x text-white"></i>
                                            </div>
                                            <!--end::Action-->
                                    </a>
                                    </div>
                                    <!--end::Card body-->
                            </div>
                                <!--end::Card-->
                        </div>
                            <div class="col-lg-6 col-xxl-4">
                                <!--begin::Budget-->
                            <div class="card h-100">
                                    <div class="card-body p-9">
                                        <div class="fs-2hx fw-bolder">@product.Price</div>
                                        <div class="fs-4 fw-bold text-gray-400 mb-7">@product.Name</div>
                                        @if (product.Sizes != null)
                                        {
                                            foreach (var size in product.Sizes)
                                            {
                                                <div class="separator separator-dashed"></div>
                                                <div class="fs-6 d-flex justify-content-between my-4">
                                                    <div class="fw-bold">@size.Name</div>
                                                    <div class="d-flex fw-bolder">
                                                        <!--begin::Svg Icon | path: icons/duotune/arrows/arr006.svg-->
                                            <span class="svg-icon svg-icon-3 me-1 svg-icon-danger">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                                <path d="M13.4 14.8L5.3 6.69999C4.9 6.29999 4.9 5.7 5.3 5.3C5.7 4.9 6.29999 4.9 6.69999 5.3L14.8 13.4L13.4 14.8Z" fill="currentColor"></path>
                                                                <path opacity="0.3" d="M19.8 8.5L8.5 19.8H18.8C19.4 19.8 19.8 19.4 19.8 18.8V8.5Z" fill="currentColor"></path>
                                                            </svg>
                                                        </span>
                                                        @size.SubPrice
                                                    </div>
                                                    <button class="btn btn-primary rounded" onclick="@(() => PickSize(size.ID))">+</button>
                                                </div>
                                            }
                                        }
                                    </div>
                                </div>
                                <!--end::Budget-->
                        </div>
                            <div class="col-lg-6 col-xxl-4">
                                @if (product.Toppings != null)
                                {
                                    foreach (var topping in product.Toppings)
                                    {
                                        <div class="separator separator-dashed"></div>
                                        <div class="fs-6 d-flex justify-content-between my-4">
                                            <div class="fw-bold">@topping.Name</div>
                                            <div class="d-flex fw-bolder">
                                                <!--begin::Svg Icon | path: icons/duotune/arrows/arr006.svg-->
                                    <span class="svg-icon svg-icon-3 me-1 svg-icon-danger">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                        <path d="M13.4 14.8L5.3 6.69999C4.9 6.29999 4.9 5.7 5.3 5.3C5.7 4.9 6.29999 4.9 6.69999 5.3L14.8 13.4L13.4 14.8Z" fill="currentColor"></path>
                                                        <path opacity="0.3" d="M19.8 8.5L8.5 19.8H18.8C19.4 19.8 19.8 19.4 19.8 18.8V8.5Z" fill="currentColor"></path>
                                                    </svg>
                                                </span>
                                                @topping.SubPrice
                                            </div>
                                            <button class="btn btn-primary rounded" onclick="@(() => AddTopping(topping.ID, topping.SubPrice))">+</button>
                                        </div>
                                    }
                                }
                            </div>
                            <div class="col-lg-6 col-xxl-4">
                                <EditForm Model="orderDetail">
                                    <div class="mb-10 fv-row fv-plugins-icon-container">
                                    <!--begin::Label-->
                                        <label class="required form-label">Lượng Đá</label>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <InputSelect @bind-Value="orderDetail.IcedType" class="form-control">
                                            @foreach(var ice in Enum.GetValues(typeof(IcedType))){
                                                <option value="@ice">@ice</option>
                                            }
                                        </InputSelect>
                                        <!--end::Input-->
                                    </div>
                                    <div class="mb-10 fv-row fv-plugins-icon-container">
                                    <!--begin::Label-->
                                        <label class="required form-label">Lượng đường</label>
                                        <!--end::Label-->
                                        <!--begin::Input-->
                                        <InputSelect @bind-Value="orderDetail.SugarType" class="form-control">
                                            @foreach(var sugar in Enum.GetValues(typeof(SugarType))){
                                                <option value="@sugar">@sugar</option>
                                            }
                                        </InputSelect>
                                        <!--end::Input-->
                                    </div>
                                </EditForm>
                            </div>
                        </div>

                    </div>
                    <!--end::Post-->

            </div>
            }
        </div>
    </div>
</div>

@code {
    [Parameter] public string ProductId { get; set; }
    private Order order;
    private ProductVm product;
    private OrderItem orderDetail;
    private int quantity;
    protected override async Task OnParametersSetAsync()
    {
        var responseProduct = await productService.GetProductById(ProductId);
        product = responseProduct.Data;
        order = GbParameter.GbParameter.Order;
        orderDetail = new OrderItem()
            {
                SubAmount = 0,
                ProductID = ProductId,
                SizeID = "6f6fc132-d92b-475f-98e3-0ba15e90706f",
            };
        base.OnParametersSet();
    }
    public async Task AddTopping(string toppingId, double subPrice)
    {
        var topping = new OrderToppingItem()
            {
                ToppingID = toppingId,
                SubPrice = subPrice
            };
        orderDetail.Toppings.Add(topping);
    }
    public async Task PickSize(string size)
    {

        orderDetail.SizeID = size;
    }
}
